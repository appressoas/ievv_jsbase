<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <base data-ice="baseUrl" href="../../../">
  <title data-ice="title">source/http/HttpRequest.js | ievv_jsbase API Document</title>
  <link type="text/css" rel="stylesheet" href="css/style.css">
  <link type="text/css" rel="stylesheet" href="css/prettify-tomorrow.css">
  <script src="script/prettify/prettify.js"></script>
  
  
  <script src="script/manual.js"></script>
</head>
<body class="layout-container" data-ice="rootContainer">

<header>
  <a href="./">Home</a>
  <a href="./manual/index.html" data-ice="manualHeaderLink">Manual</a>
  <a href="identifiers.html">Reference</a>
  <a href="source.html">Source</a>
  
  
  <div class="search-box">
  <span>
    <img src="./image/search.png">
    <span class="search-input-edge"></span><input class="search-input"><span class="search-input-edge"></span>
  </span>
    <ul class="search-result"></ul>
  </div>
</header>

<nav class="navigation" data-ice="nav"><div>
  <ul>
    
  <li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/source/SignalHandlerSingleton.js~ReceivedSignalInfo.html">ReceivedSignalInfo</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/source/SignalHandlerSingleton.js~SentSignalInfo.html">SentSignalInfo</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/source/SignalHandlerSingleton.js~SignalHandlerSingleton.html">SignalHandlerSingleton</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-makeCustomError">makeCustomError</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-DuplicateReceiverNameForSignal">DuplicateReceiverNameForSignal</a></span></span></li>
<li data-ice="doc"><div data-ice="dirPath" class="nav-dir-path">__testhelpers__</div><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/source/__testhelpers__/XMLHttpRequestMock.js~XMLHttpRequestMock.html">XMLHttpRequestMock</a></span></span></li>
<li data-ice="doc"><div data-ice="dirPath" class="nav-dir-path">dom</div><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/source/dom/DOMReplace.js~DOMReplace.html">DOMReplace</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/source/dom/DOMReplaceFromUrl.js~DOMReplaceFromUrl.html">DOMReplaceFromUrl</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/source/dom/DOMReplaceWithSameElementFromUrl.js~DOMReplaceWithSameElementFromUrl.html">DOMReplaceWithSameElementFromUrl</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/source/dom/HtmlParser.js~HtmlParser.html">HtmlParser</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/source/dom/ScriptLoaderSingleton.js~Script.html">Script</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/source/dom/ScriptLoaderSingleton.js~ScriptLoaderSingleton.html">ScriptLoaderSingleton</a></span></span></li>
<li data-ice="doc"><div data-ice="dirPath" class="nav-dir-path">html</div><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/source/html/CleanHtml.js~CleanHtml.html">CleanHtml</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/source/html/CleanHtml.js~CleanHtmlOptions.html">CleanHtmlOptions</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/source/html/CleanHtml.js~CleanHtmlParser.html">CleanHtmlParser</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/source/html/CleanHtml.js~CleanerNode.html">CleanerNode</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/source/html/CleanHtml.js~FlatListCleanerNode.html">FlatListCleanerNode</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/source/html/CleanHtml.js~NoTextCleanerNode.html">NoTextCleanerNode</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-attributeObjectToHtml">attributeObjectToHtml</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-escapeAttributeValue">escapeAttributeValue</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-isInlineTag">isInlineTag</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-isSelfClosingTag">isSelfClosingTag</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-makeHtmlEndTag">makeHtmlEndTag</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-makeHtmlStartTag">makeHtmlStartTag</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-PasteMarkerNotSetError">PasteMarkerNotSetError</a></span></span></li>
<li data-ice="doc"><div data-ice="dirPath" class="nav-dir-path">http</div><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/source/http/HttpCookies.js~HttpCookies.html">HttpCookies</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/source/http/HttpDjangoFileRequest.js~HttpDjangoFileRequest.html">HttpDjangoFileRequest</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/source/http/HttpDjangoJsonRequest.js~HttpDjangoJsonRequest.html">HttpDjangoJsonRequest</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/source/http/HttpFileRequest.js~HttpFileRequest.html">HttpFileRequest</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/source/http/HttpFileResponse.js~HttpFileResponse.html">HttpFileResponse</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/source/http/HttpJsonRequest.js~JsonHttpRequest.html">JsonHttpRequest</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/source/http/HttpJsonResponse.js~HttpJsonResponse.html">HttpJsonResponse</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/source/http/HttpRequest.js~HttpRequest.html">HttpRequest</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/source/http/HttpResponse.js~HttpResponse.html">HttpResponse</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/source/http/QueryString.js~QueryString.html">QueryString</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/source/http/UrlParser.js~UrlParser.html">UrlParser</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-HttpCookieNotFoundError">HttpCookieNotFoundError</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-HttpResponseError">HttpResponseError</a></span></span></li>
<li data-ice="doc"><div data-ice="dirPath" class="nav-dir-path">log</div><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/source/log/AbstractLogger.js~AbstractLogger.html">AbstractLogger</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/source/log/Logger.js~Logger.html">Logger</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/source/log/LoggerSingleton.js~LoggerSingleton.html">LoggerSingleton</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/source/log/loglevel.js~LogLevels.html">LogLevels</a></span></span></li>
<li data-ice="doc"><div data-ice="dirPath" class="nav-dir-path">polyfill</div><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-elementRemovePolyfill">elementRemovePolyfill</a></span></span></li>
<li data-ice="doc"><div data-ice="dirPath" class="nav-dir-path">utils</div><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/source/utils/ObjectManager.js~ObjectManager.html">ObjectManager</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/source/utils/PrettyFormat.js~PrettyFormat.html">PrettyFormat</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/source/utils/TypeConvert.js~TypeConvert.html">TypeConvert</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-getFileExtension">getFileExtension</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-onDocumentReady">onDocumentReady</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-ensureMapHasDataInReduxStore">ensureMapHasDataInReduxStore</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-getObjectFromReduxMapOrNullIfLoading">getObjectFromReduxMapOrNullIfLoading</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-getValuesFromTypeMappedReduxMap">getValuesFromTypeMappedReduxMap</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-makeApiDataMapDeleted">makeApiDataMapDeleted</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-makeApiDataMapError">makeApiDataMapError</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-makeApiDataMapIsLoading">makeApiDataMapIsLoading</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-makeApiDataMapNewData">makeApiDataMapNewData</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-makeImmutableOrderedMapFromValueArray">makeImmutableOrderedMapFromValueArray</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-makeTypeMappedReduxMapFromApiData">makeTypeMappedReduxMapFromApiData</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-typeDetect">typeDetect</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-TYPE_MAPPED_REDUX_MAP_DEFAULT_KEY">TYPE_MAPPED_REDUX_MAP_DEFAULT_KEY</a></span></span></li>
<li data-ice="doc"><div data-ice="dirPath" class="nav-dir-path">widget</div><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/source/widget/AbstractWidget.js~AbstractWidget.html">AbstractWidget</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/source/widget/WidgetRegistrySingleton.js~WidgetRegistrySingleton.html">WidgetRegistrySingleton</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-ElementHasNoWidgetInstanceIdError">ElementHasNoWidgetInstanceIdError</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-ElementIsNotInitializedAsWidget">ElementIsNotInitializedAsWidget</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-ElementIsNotWidgetError">ElementIsNotWidgetError</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-InvalidWidgetAliasError">InvalidWidgetAliasError</a></span></span></li>
</ul>
</div>
</nav>

<div class="content" data-ice="content"><h1 data-ice="title">source/http/HttpRequest.js</h1>
<pre class="source-code line-number raw-source-code"><code class="prettyprint linenums" data-ice="content">import HttpResponse from &quot;./HttpResponse&quot;
import {UrlParser} from &quot;./UrlParser&quot;


/**
 * API for performing HTTP requests.
 *
 * @example &lt;caption&gt;Make a POST request&lt;/caption&gt;
 * const request = new HttpRequest(&apos;http://example.com/api/users/&apos;)
 * request.post(&apos;Hello world&apos;)
 *     .then((response) =&gt; {
 *         // Success - response is a HttpResponse object.
 *         console.log(response.toString())
 *         if(response.isSuccess()) {
 *             console.log(&apos;Success: &apos;, response.body)
 *         } else if (response.isRedirect) {
 *             console.log(&apos;Hmm strange, we got a redirect instead of a 2xx response.&apos;)
 *         }
 *     })
 *     .catch((error) =&gt; {
 *         // Error - response is an HttpResponse object.
 *         console.error(error.toString())
 *         if(error.response.isRedirect()) {
 *             // Yes - redirect is treated as an error by default.
 *             // you can change this by supplying an extra argument
 *             // to HttpResponse()
 *             console.log(&apos;We got a 3xx response!&apos;, error.response.body)
 *         } else if(error.response.isClientError()) {
 *             console.log(&apos;We got a 4xx response!&apos;, error.response.body)
 *         } else if (error.response.isServerError()) {
 *             console.log(&apos;We got a 5xx response!&apos;, error.response.body)
 *         } else if (error.response.isConnectionRefused()) {
 *             console.log(&apos;Connection refused.&apos;)
 *         }
 *         // throw error  // You can throw the error as an exception
 *     })
 *
 * @example &lt;caption&gt;Make a GET request with a querystring&lt;/caption&gt;
 * const request = new HttpRequest(&apos;http://example.com/api/users/&apos;)
 * request.urlParser.queryString.set(&apos;search&apos;, &apos;doe&apos;)
 * request.get()
 *     .then((response) =&gt; {
 *         console.log(&apos;Success!&apos;, response.toString())
 *     })
 *     .catch((error) =&gt; {
 *         console.error(&apos;Error:&apos;, error.toString())
 *     })
 */
export default class HttpRequest {
  /**
   * @param {string} url The URL to request.
   *      If this is supplied, it is passed to
   *      {@link HttpRequest#setUrl}
   */
  constructor(url) {
    this._treatRedirectResponseAsError = true
    this.requestHeaders = new Map()
    this.request = null
    this._urlParser = null
    if(typeof url !== &apos;undefined&apos;) {
      this.setUrl(url)
    }
  }

  /**
   * Create a deep copy of this HttpRequest object.
   *
   * WARNING: This does not copy request headers since those
   * are set on the XMLHttpRequest object, and that object is
   * reset in the copy.
   *
   * @return The copy.
   */
  deepCopy () {
    let copy = Object.assign(Object.create(this), this)
    copy.request = null
    if (this._urlParser !== null) {
      copy._urlParser = this._urlParser.deepCopy()
    }
    copy.requestHeaders = new Map(this.requestHeaders)
    return copy
  }

  /**
   * Get the parsed URL of the request.
   *
   * @returns {UrlParser} The UrlParser for the parsed URL.
   */
  get urlParser() {
    return this._urlParser
  }

  /**
   * Set the URL of the request.
   *
   * @param {String} url The URL.
   */
  setUrl(url) {
    this._urlParser = new UrlParser(url)
  }

  /**
   * Set how we treat 3xx responses.
   *
   * By default they are treated as errors, but you can change
   * this behavior by calling this function.
   *
   * @param {bool} treatRedirectResponseAsError Treat 3xx responses as
   *      errors?
   *
   * @example &lt;caption&gt;Do not treat 3xx responses as error&lt;/caption&gt;
   * const request = HttpRequest(&apos;http://example.com/api/&apos;)
   * request.setTreatRedirectResponseAsError(false)
   */
  setTreatRedirectResponseAsError(treatRedirectResponseAsError) {
    this._treatRedirectResponseAsError = treatRedirectResponseAsError
  }

  _makeXMLHttpRequest () {
    return new XMLHttpRequest()
  }

  /**
   * Send the request.
   *
   * @param method The HTTP method. I.e.: &quot;get&quot;, &quot;post&quot;, ...
   * @param data Request body data. This is sent through
   *      {@link HttpRequest#makeRequestBody} before it
   *      is sent.*
   * @return {Promise} A Promise.
   *
   *      The resolve function argument is an
   *      an object of whatever {@link HttpRequest#makeResponse}
   *      returns.
   *
   *      The reject function argument is a
   *      {@link HttpResponseError} object created using
   *      {@link HttpResponse#toError}.
   */
  send(method, data) {
    method = method.toUpperCase()
    if(this._urlParser === null) {
      throw new TypeError(&apos;Can not call send() without an url.&apos;)
    }
    return new Promise((resolve, reject) =&gt; {
      this.request = this._makeXMLHttpRequest()
      this.request.open(method, this.urlParser.buildUrl(), true)
      this.setDefaultRequestHeaders(method)
      this._applyRequestHeadersToRequest()
      this.request.onload  = () =&gt; this._onComplete(resolve, reject)
      this.request.send(this.makeRequestBody(data))
    })
  }

  /**
   * Shortcut for ``send(&quot;get&quot;, data)``.
   *
   * @see {@link HttpRequest#send}
   */
  get(data) {
    return this.send(&apos;get&apos;, data)
  }

  /**
   * Shortcut for ``send(&quot;head&quot;, data)``.
   *
   * @see {@link HttpRequest#send}
   */
  head(data) {
    return this.send(&apos;head&apos;, data)
  }

  /**
   * Shortcut for ``send(&quot;post&quot;, data)``.
   *
   * @see {@link HttpRequest#send}
   */
  post(data) {
    return this.send(&apos;post&apos;, data)
  }

  /**
   * Shortcut for ``send(&quot;put&quot;, data)``.
   *
   * @see {@link HttpRequest#send}
   */
  put(data) {
    return this.send(&apos;put&apos;, data)
  }

  /**
   * Shortcut for ``send(&quot;patch&quot;, data)``.
   *
   * @see {@link HttpRequest#send}
   */
  patch(data) {
    return this.send(&apos;patch&apos;, data)
  }

  /**
   * Shortcut for ``send(&quot;delete&quot;, data)``.
   *
   * Named httpdelete to avoid crash with builtin keyword ``delete``.
   *
   * @see {@link HttpRequest#send}
   */
  httpdelete(data) {
    return this.send(&apos;delete&apos;, data)
  }

  /**
   * Make request body from the provided data.
   *
   * By default this just returns the provided data,
   * but subclasses can override this to perform automatic
   * conversion.
   *
   * Must return a string.
   */
  makeRequestBody(data) {
    return data
  }

  /**
   * Creates a {@link HttpResponse}.
   * @returns {HttpResponse}
   */
  makeResponse() {
    return new HttpResponse(this.request)
  }

  _applyRequestHeadersToRequest () {
    for (let [header, value] of this.requestHeaders) {
      this.request.setRequestHeader(header, value)
    }
  }

  /**
   * Set a request header.
   *
   * @param header The header name. E.g.: ``&quot;Content-type&quot;``.
   * @param value The header value.
   */
  setRequestHeader(header, value) {
    this.requestHeaders.set(header, value)
  }

  /**
   * Set default request headers.
   *
   * Does nothing by default, but subclasses can override this.
   *
   * @param method The HTTP request method (GET, POST, PUT, ...).
   *      Will always be uppercase.
   */
  setDefaultRequestHeaders(method) {}

  _onComplete(resolve, reject) {
    let response = this.makeResponse()
    let isSuccess = false
    if(this._treatRedirectResponseAsError) {
      isSuccess = response.isSuccess()
    } else {
      isSuccess = response.isSuccess() || response.isRedirect()
    }
    if(isSuccess) {
      resolve(response)
    } else {
      reject(response.toError())
    }
  }
}
</code></pre>

</div>

<footer class="footer">
  Generated by <a href="https://esdoc.org">ESDoc<span data-ice="esdocVersion">(0.4.8)</span></a>
</footer>

<script src="script/search_index.js"></script>
<script src="script/search.js"></script>
<script src="script/pretty-print.js"></script>
<script src="script/inherited-summary.js"></script>
<script src="script/test-summary.js"></script>
<script src="script/inner-link.js"></script>
<script src="script/patch-for-local.js"></script>
</body>
</html>
